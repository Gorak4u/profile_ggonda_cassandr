# Cassandra YAML Configuration
# Managed by Puppet, profile_ggonda_cassandr module

cluster_name: '<%= @cluster_name %>'
num_tokens: 256
seed_provider:
    - class_name: org.apache.cassandra.locator.SimpleSeedProvider
      parameters:
          - seeds: "<%= @seeds %>"

listen_address: <%= @::ipaddress %>
rpc_address: <%= @::ipaddress %>

# Ports
storage_port: 7000
ssl_storage_port: 7001
native_transport_port: 9042
# For Cassandra 3.x, start_rpc should be true. For 4.x+, it should be false (replaced by native_transport_port)
<% if @cassandra_version =~ /^3\./ %>
start_rpc: true
rpc_port: 9160
<% else %>
start_rpc: false
# rpc_port: 9160 # For compatibility, keep commented for 4.x+
<% end %>

endpoint_snitch: GossipingPropertyFileSnitch

data_file_directories:
    - <%= @data_directory %>
commitlog_directory: <%= @commitlog_directory %>

partitioner: org.apache.cassandra.dht.Murmur3Partitioner

authenticator: org.apache.cassandra.auth.PasswordAuthenticator
authorizer: org.apache.cassandra.auth.CassandraAuthorizer
role_manager: org.apache.cassandra.auth.CassandraRoleManager

auto_snapshot: true
concurrent_reads: 32
concurrent_writes: 32
concurrent_compactors: <%= [(processorcount / 2).to_i, 1].max %> # Roughly half of CPU cores
compaction_throughput_mb_per_sec: 16 # Default is 16, good starting point

# Heap sizes (set in jvm-server.options, but often seen here in older configs)
# This is typically configured in jvm-server.options now.
# max_heap_size: <%= @max_heap_size %>

# Rack-aware datacenter placement
# To be configured in cassandra-rackdc.properties
# dc: <%= @datacenter %>
# rack: <%= @rack %>
