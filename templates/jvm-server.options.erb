# JVM Server Options for Cassandra
# Managed by Puppet, profile_ggonda_cassandr module
# This file is used by Cassandra 4.x+ instead of jvm.options

# Heap size:
-Xms<%= @max_heap_size %>
-Xmx<%= @max_heap_size %>

# GC configuration
<% if @java_version == "8" %>
-XX:+Use<%= @gc_type %>GC
-XX:+CMSParallelRemarkEnabled
-XX:SurvivorRatio=8
-XX:MaxTenuringThreshold=1
-XX:+CMSClassUnloadingEnabled
-XX:+CMSPermGenSweepingEnabled
-XX:CMSInitiatingOccupancyFraction=75
-XX:+UseCMSInitiatingOccupancyOnly
-XX:+HeapDumpOnOutOfMemoryError
-XX:HeapDumpPath=/var/lib/cassandra/java_heap_dump.hprof
# GC logging for Java 8
-XX:+PrintGCDetails
-XX:+PrintGCDateStamps
-XX:+PrintHeapAtGC
-XX:+PrintTenuringDistribution
-XX:+PrintGCApplicationStoppedTime
-XX:+UseGCLogFileRotation
-XX:NumberOfGCLogFiles=10
-XX:GCLogFileSize=10M
-Xloggc:/var/log/cassandra/gc.log
<% elsif @java_version == "11" %>
-XX:+Use<%= @gc_type %>GC
-XX:+HeapDumpOnOutOfMemoryError
-XX:HeapDumpPath=/var/lib/cassandra/java_heap_dump.hprof
# GC logging for Java 11+
-Xlog:gc*=info,heap*=debug,age*=trace,safepoint*=info:file=/var/log/cassandra/gc.log:time,uptime,pid,level,tags:filecount=10,filesize=10M
<% else %>
# Fallback for other Java versions or if GC type is not specified
# Recommend using G1GC for modern Cassandra
-XX:+UseG1GC
<% end %>

# JMX options
-Dcom.sun.management.jmxremote.port=7199
-Dcom.sun.management.jmxremote.rmi.port=7199
-Dcom.sun.management.jmxremote.authenticate=false
-Dcom.sun.management.jmxremote.password.file=/etc/cassandra/jmxremote.password
-Dcom.sun.management.jmxremote.access.file=/etc/cassandra/jmxremote.access
-Dcom.sun.management.jmxremote.ssl=false

# Other critical settings
-Dcassandra.jamm.enable=true
-Dcassandra.metrics.reporter.enabled=false
-Dcassandra.ring_delay_ms=30000
-Dcassandra.initial_token=
<% if @replace_dead_node_ip and @replace_dead_node_ip != '' %>
-Dcassandra.replace_address=<%= @replace_dead_node_ip %>
<% end %>
-Djava.net.preferIPv4Stack=true
-Dlogback.configurationFile=logback.xml
-Dlogback.disableJMX=true
-Djava.awt.headless=true
-ea
-Xss256k # Recommended for Cassandra 4.x
-Djdk.attach.allowAttachSelf=true
